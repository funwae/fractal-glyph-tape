# 工程概览（Fractal Glyph Tape）

> 说明：本文件主要面向「内部 AI 助手 / 构建脚本」，采用简明中文描述整体工程结构和约定。人类读者如需英语版本，请参考 `00-vision-overview.md` 和 `30-system-architecture-overview.md`。

---

## 1. 项目目标（简述）

- 将大规模语料中的「相似短语 / 句式」聚类成短语族（phrase families）。

- 为每个短语族分配一个 **glyph ID**，由汉字字符组合而成，但不使用原本语义，仅作为 **紧凑的图形编码**。

- 将所有 glyph ID 嵌入到一个 **分形地址空间（fractal tape）**：

  - 多尺度（粗粒度语义区域 + 细粒度短语族）。

  - 保持局部相似性。

- 将该结构作为：

  - 语料压缩格式。

  - LLM 上下文扩展 / 内部记忆层。

  - 多语言语义锚点。

---

## 2. 主要组件

1. **数据导入（Ingestion）**

   - 从原始语料中提取句子、短语、n-gram。

   - 记录语言标签、来源等元信息。

2. **短语嵌入（Embedding）**

   - 使用 GPU 上的 Transformer 编码器生成向量。

   - 分片存储 `.npy` 文件。

3. **短语聚类（Clustering）**

   - 使用 Mini-batch KMeans 等方法。

   - 输出 `cluster_id` 和聚类中心。

4. **glyph 分配（Glyph Assignment）**

   - 为每个 `cluster_id` 分配 `glyph_id`（整数）。

   - `glyph_id` 再映射到一串汉字字符。

5. **分形地址（Fractal Addressing）**

   - 将聚类中心投影到 2D。

   - 归一化到三角形区域。

   - 通过递归划分生成 `(level, cell_id)`。

6. **存储层（Tape Storage）**

   - `cluster_id -> glyph_id, address` 的稠密表。

   - 辅助索引：`glyph_id -> cluster_id`、`address -> cluster list`。

7. **分词包装器（Tokenizer Wrapper）**

   - 接受原始文本。

   - 检测可映射到短语族的 span。

   - 使用相应 glyph 字符替换。

8. **评估与可视化（Eval & Viz）**

   - 压缩率、上下文效率、多语言检索等指标。

   - Web 可视化：分形地图 + hover 示例。

---

## 3. 目录结构（建议）

```text
/ (repo root)
  /docs        文档（设计、规范、实验）
  /data        原始数据、处理后数据
  /embeddings  嵌入向量分片
  /clusters    聚类结果与元数据
  /tape        glyph / 分形地址存储
  /src
    /ingest
    /embed
    /cluster
    /glyph
    /tape
    /tokenizer
    /eval
    /viz
  /scripts     端到端 pipeline 脚本
```

---

## 4. 第一阶段目标（Phase 0 / Demo）

在单台 Linux + RTX GPU 机器上完成：

1. 小规模语料（例如：10 万句英文 + 1 万句中文）。

2. 端到端 pipeline：

   * 导入 → 嵌入 → 聚类 → glyph → 分形地址 → 存储。

3. 一个 CLI demo：

   * 输入一段文本。

   * 输出：

     * glyph 替换版本。

     * 显示涉及的短语族示例。

4. 一个简单 Web 可视化：

   * 基于 pre-computed 2D 坐标。

   * 显示 glyph 点云 + hover 示例。

---

## 5. 命名约定 / 术语（内部）

* **短语族**：phrase family / cluster。

* **glyph ID**：整数 ID（internal）。

* **glyph 字符串**：由 1–4 个汉字组成，作为外显编码。

* **分形地址**：`FractalAddress`，包含 `tape_version, level, cell_id`。

* **tape**：整个分形地址空间 + 对应的短语族映射。

---

## 6. AI 助手注意事项

* 生成代码时优先：

  * 清晰的数据结构定义。

  * 可恢复的 pipeline（中间结果可缓存）。

* 优先保证：

  * 可重复实验。

  * 度量指标明确。

后续细节请参考：

* `30-system-architecture-overview.md` 架构图。

* `41-data-ingestion-implementation.md` 数据入口。

* `42-embedding-and-clustering-impl.md` 嵌入与聚类。

* `44-fractal-tape-storage-impl.md` 存储实现。

* 各 `60+` 文档中的评估计划。

